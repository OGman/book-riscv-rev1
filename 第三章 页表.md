操作系统通过页表为每一个进程提供了它自己的私有地址空间和内存。页表决定了内存地址表示什么，也决定了哪部分物理地址可以被访问。它们允许xv6将不同进程的地址空间隔离开来，并将他们复用到同一物理内存上。页表提供了一个间接层，让xv6能玩一些小花招：将同一段内存（跳板页）映射到不同的地址空间，使用未映射的页来保护内核和用户栈。本章中其他部分解释了RISC-V硬件所提供的页表，以及xv6如何使用它们。

# 3.1 分页硬件

提醒一下，RISC-V指令（包括用户和内核）使用虚拟地址。而机器的RAM，或物理内存，使用物理地址进行索引。RISC-V页表硬件连接这两种地址，将虚拟地址映射到物理地址。

xv6运行在Sv39 RISC-V上，这表示在64位虚拟地址中，只使用了低39位，而高25位未使用。在这种Sv39配置中，RISC-V页表逻辑上是一个包含2^27（134,217,728）个页表项（PTE，page table entry）的向量表。每个PTE包含一个44位物理页编码（PPN，physical page number）和一些标志位。分页硬件使用39位虚拟地址中的高27位作为索引，在页表中找到对应的PTE，然后用PTE中的44位地址作为高位，虚拟地址中的低12位作为地位，构造出一个56位的物理地址。图3.1展现了这个过程，其中页表按照逻辑理解，被描绘为一个PTE构成的向量表（图3.2给出了真实情况）。页表给予了操作系统控制虚拟地址到物理地址翻译的能力。内存的粒度大小是4096（2^12）的对齐块。这种块叫作页。

在Sv39 RISC-V中，高25位没有参与到地址转换中；未来RISC-V可能会使用这些位定义更多层的地址转换。物理地址也还有增加的空间：PTE格式中的物理页编号仍有增长10位的空间。

如图3.2，实际的地址转换分为三步。页表以三层树的结构保存在物理内存中。树的根是一张4096字节的页表，包含512PTE，每个PTE都包含了下一层页表存放页的物理地址。这些页中包含了512PTE，保存树的最终层。分页硬件使用27位中的高9位查找根页表中的PTE，中9位查找中层页表中的PTE，低9位查找最终PTE。



A page table gives the operating system control over virtual-to-physical address translations at the granularity of aligned chunks of 4096 bytes. Such a chunk is called a page.
In Sv39 RISC-V, the top 25 bits of a virtual address are not used for translation; in the future,
RISC-V may use those bits to define more levels of translation. The physical address also has room
for growth: there is room in the PTE format for the physical page number to grow by another 10
bits.

# 3.2 内核地址空间

# 3.3 代码：创建地址空间

# 3.4 物理内存分配

# 3.5 代码：物理内存分配器

# 3.6 进程地址空间

# 3.7 代码：sbrk

# 3.8 代码：exec

# 3.9 真实世界
