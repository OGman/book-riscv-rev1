操作系统的工作，一个是在不同程序之间共享计算机，一个是提供比硬件所提供的的服务更好用的服务集合。操作系统管理并抽象底层硬件，因此，举例来说，文字处理器不需要考虑自己用的是什么类型的硬盘硬件。操作系统将硬件在多个程序之间分享，让它们能同时运行（或看起来是同时运行）。最后，操作系统为程序间的交互提供受控的方法，这样它们就能共享数据或协同工作。

操作系统通过接口向用户进程提供服务。设计一套好的接口很难。一方面，我们希望接口简单而狭窄，因为这样的接口容易正确地使用。另一方面，我们可能尝试为应用程序提供很多复杂的特性。解决这个矛盾的方法，是设计依赖于一些机制的接口，它们可以组合起来，提供更通用的功能。

本书使用一个简单的操作系统作为具体的例子，来阐述操作系统的概念。xv6操作系统提供了Ken Thompson与Dennis Ritchie的Unix操作系统引入的基础接口[14]，以及模仿Unix的内部实现。Unix提供了一组狭窄的接口，其机制可以很好地结合，从而提供了令人惊讶的通用性。这组接口相当成功，现代操作系统——BSD，Linux，MAC OS X，Solarias，甚至较低程度地，Microsoft Windows——都有类Unix接口。理解xv6对于理解这些操作系统中的任何一种以及很多其他的系统来说，是一个很好地开始。

如图1.1所示，xv6延续了内核的传统，内核是一个特殊的程序，它为程序运行提供了服务。运行的程序叫做进程，有着包含指令、数据和一个栈的内存。指令实现了程序的计算。数据是计算中所使用的变量。栈组织了程序的调用过程。典型地，一台给定的计算机有很多进程，但只有一个内核。

当进程需要调用内核服务时，它调用一个系统调用，操作系统接口中的一种。系统调用进入到内核；内核执行对应的服务并返回。因此，进程在用户空间和内核空间之间切换。

内核使用CPU提供的硬件保护机制来保证每个运行在用户空间的进程只能访问它自己的内存。内核以实现这些保护所需要的硬件特权执行；用户程序没有这些特权。当用户程序调用系统调用时，硬件提升其特权级别，开始执行内核中提前安排好的函数。

内核提供的系统调用的集合是用户程序所看到的接口。xv6提供了Unix内核传统上提供的系统调用的一个子集。图1.2列出了所有的xv6系统调用。

本章其余部分简要描述了xv6提供的服务——进程、内存、文件描述符、管道以及一个文件系统——并使用代码片段举例说明了它们，还讨论了shell（Unix的命令行用户界面）如何使用它们。shell对系统调用的使用说明了系统调用的设计是多么仔细。

shell是一个普通程序，它从用户读取命令并执行。shell是用户程序而非内核一部分的事实说明了系统调用接口的强大：shell没什么特别的。它也说明，shell很容易被取代；这就造成现代Unix系统有大量可选的shell，每种shell都有自己的用户界面和脚本特性。xv6 shell是Unix Bourne shell精髓部分的简单实现。它的实现可以在（user/sh.c:1）中找到。


snippet